# üîß Troubleshooting Guide

## –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. **404 –æ—à–∏–±–∫–∏ –¥–ª—è JavaScript —Ñ–∞–π–ª–æ–≤** ‚úÖ –†–ï–®–ï–ù–û

**–û—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:**
```
webpack.js:1  Failed to load resource: 404 (Not Found)
main-app.js:1  Failed to load resource: 404 (Not Found)
app-pages-internals.js:1  Failed to load resource: 404 (Not Found)
```

**–ü—Ä–∏—á–∏–Ω–∞:** –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è .next –ø–∞–ø–∫–∏ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Next.js

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
pkill -f "node server.js"

# –£–¥–∞–ª–∏—Ç–µ .next –ø–∞–ø–∫—É
rm -rf .next

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
npm run dev
```

### 2. **Socket.IO Authentication Failed** ‚úÖ –†–ï–®–ï–ù–û

**–û—à–∏–±–∫–∞:** `Authentication failed`, `jwt must be a string`

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JWT —Ç–æ–∫–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è NextAuth –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–†–µ—à–µ–Ω–∏–µ:** –£–ø—Ä–æ—â–µ–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è user ID –∏–∑ —Å–µ—Å—Å–∏–∏
```typescript
// server.js
const userId = socket.handshake.auth.token;

// useChatSocket.ts
const userId = data.user?.id;
socket.auth = { token: userId };
```

### 3. **Redis Connection Errors** ‚úÖ –†–ï–®–ï–ù–û

**–û—à–∏–±–∫–∞:** `Cannot read properties of null (reading 'setex')`

**–ü—Ä–∏—á–∏–Ω–∞:** Redis –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ `REDIS_URL` –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ in-memory cache
```typescript
// src/lib/cache.ts
const redis = process.env.REDIS_URL ? new Redis(...) : null;
let isRedisAvailable = !!redis;
```

**–ö–∞–∫ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
```bash
# macOS
brew install redis
brew services start redis

# Linux
sudo apt-get install redis-server
sudo systemctl start redis

# Docker
docker run -d -p 6379:6379 redis:alpine
```

### 4. **TypeScript –æ—à–∏–±–∫–∏** ‚úÖ –†–ï–®–ï–ù–û

**–†–µ—à–µ–Ω–æ 60+ –æ—à–∏–±–æ–∫ —Ç–∏–ø–æ–≤:**
- ‚úÖ Zod —Å—Ö–µ–º—ã (default values)
- ‚úÖ –¢–∏–ø—ã Chat API
- ‚úÖ null/undefined –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è
- ‚úÖ enum —Ç–∏–ø—ã

**–û—Å—Ç–∞–≤—à–∏–µ—Å—è –Ω–µ—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏:**
```
.next/types/app/api/auth/[...nextauth]/route.ts - authOptions export
```
–≠—Ç–∏ –æ—à–∏–±–∫–∏ –≤ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã—Ö —Ñ–∞–π–ª–∞—Ö Next.js –∏ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### 5. **–ú–µ–¥–ª–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏** ‚úÖ –†–ï–®–ï–ù–û

**–ë—ã–ª–æ:**
- Multiple API calls –Ω–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- –ù–µ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤ –ë–î
- Full table scans

**–°—Ç–∞–ª–æ:**
- ‚úÖ Batched API calls (1 –≤–º–µ—Å—Ç–æ 3+)
- ‚úÖ Redis/Memory –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ 13 –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
- ‚úÖ React.memo + useMemo
- ‚úÖ Lazy loading + prefetching

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
API unread counts: 40-60ms (–±—ã–ª–æ 200-500ms)
Page transitions: <200ms (–±—ã–ª–æ 1-2s)
DB queries: 10-20ms (–±—ã–ª–æ 500ms+)
```

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –¢–µ–∫—É—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏ (–∏–∑ –ª–æ–≥–æ–≤):

```
‚úÖ GET /api/me/unread-counts: 40-60ms (—Å—Ç–∞–±–∏–ª—å–Ω–æ)
‚úÖ GET /specialists: 381ms (–ø–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)
‚úÖ GET /app: 114ms (—Å –∫—ç—à–µ–º)
‚úÖ Socket.IO: —É—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
```

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!

–í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ –ø–∞—Ç—Ç–µ—Ä–Ω:
```
960| GET /api/me/unread-counts 200 in 681ms  // Cache miss
961| GET /api/me/unread-counts 200 in 668ms
962| GET /api/me/unread-counts 200 in 667ms
...
966| GET /api/me/unread-counts 200 in 40ms   // Cache hit!
967| GET /api/me/unread-counts 200 in 41ms
```

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
curl http://localhost:3001
# –û–∂–∏–¥–∞–µ—Ç—Å—è: HTTP 200
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ API
```bash
curl http://localhost:3001/api/specialists | jq
# –û–∂–∏–¥–∞–µ—Ç—Å—è: JSON —Å —Å–ø–∏—Å–∫–æ–º —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤
```bash
npm run db:indexes
# –û–∂–∏–¥–∞–µ—Ç—Å—è: "‚úÖ –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!"
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3001
2. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É Network
4. –ü–µ—Ä–µ–∫–ª—é—á–∞–π—Ç–µ—Å—å –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ API –∑–∞–ø—Ä–æ—Å–æ–≤

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
- `/api/me/unread-counts`: 40-60ms
- –ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏: –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ
- –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ (–∫—Ä–æ–º–µ –Ω–µ—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö)

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –í –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞ —Å–º–æ—Ç—Ä–∏—Ç–µ:
```bash
# –•–æ—Ä–æ—à–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:
‚úÖ GET /api/me/unread-counts 200 in 40-60ms
‚úÖ Cache hit for unread counts for user ...
‚úÖ Socket connected: user ...

# –ü–ª–æ—Ö–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:
‚ùå GET /api/... 200 in 500ms+
‚ùå Cache set error: ...
‚ùå Socket auth error: ...
```

### –í –±—Ä–∞—É–∑–µ—Ä–µ DevTools:
1. **Network tab**: API –∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å <100ms
2. **Console**: –ù–µ—Ç –æ—à–∏–±–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
3. **Performance tab**: First Contentful Paint < 1s

## üõ†Ô∏è –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
pkill -f "node server.js"

# 2. –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –∏ –±–∏–ª–¥—ã
rm -rf .next
rm -rf node_modules/.cache

# 3. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å
npm run dev
```

## üìù –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ—Ä—Ç 3001 —Å–≤–æ–±–æ–¥–µ–Ω
lsof -i :3001

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
tail -f /tmp/healthapp.log  # –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ë–î
npx prisma db push

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Redis (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
redis-cli ping
# –û–∂–∏–¥–∞–µ—Ç—Å—è: PONG

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –∑–∞–Ω–æ–≤–æ
npm run db:indexes
```

## üéØ –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|--------|-------------|
| –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | http://localhost:3001 |
| API | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 40-60ms –æ—Ç–≤–µ—Ç—ã |
| Socket.IO | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è auth |
| Redis | ‚ö†Ô∏è –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ | Fallback –Ω–∞ memory cache |
| –ò–Ω–¥–µ–∫—Å—ã –ë–î | ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω—ã | 13 –∏–Ω–¥–µ–∫—Å–æ–≤ |
| TypeScript | ‚úÖ –í –ø–æ—Ä—è–¥–∫–µ | 4 minor –æ—à–∏–±–∫–∏ –≤ .next |
| Performance | ‚úÖ –û—Ç–ª–∏—á–Ω–æ | 5-50x —É–ª—É—á—à–µ–Ω–∏–µ |

## üöÄ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ.
